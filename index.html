<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MeMes' World</title>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, Helvetica Neue, Arial, sans-serif;
      background: #f6f6f6;
      display: flex;
      justify-content: center;
      padding: 40px;
    }
    .container {
      width: 100%;
      max-width: 1100px;
      background: white;
      border-radius: 20px;
      padding: 40px 40px 60px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    }
    h1 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 30px;
      font-weight: 500;
    }
    .top-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 0 10px;
      font-size: 18px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 15px;
    }
    .tile {
      width: 100%;
      padding-top: 100%;
      background: #ddd;
      border-radius: 6px;
      position: relative;
      overflow: hidden;
    }
    .tile img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .dropzone {
      padding: 8px 18px;
      border: 1px dashed #999;
      border-radius: 999px;
      font-size: 15px;
      cursor: pointer;
      transition: 0.2s;
    }
    .dropzone:hover {
      background: #eee;
    }
    .dropzone.dragover {
      background: #e8f2ff;
      border-color: #2b7cff;
      color: #2b7cff;
    }
    input[type=file] {
      display: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Welcome to the MeMesâ€™ World</h1>

    <div class="top-row">
      <div>Explore More</div>
      <div id="dropzone" class="dropzone">Drop A Meme</div>
    </div>

    <div id="grid" class="grid"></div>

    <input id="fileInput" type="file" accept="image/*" />
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // ðŸ”¥ Your Firebase Config (replace with your real values)
    const firebaseConfig = {
      apiKey: "AIzaSyC4SFP...YOURVALUE...",
      authDomain: "memes-world-6276b.firebaseapp.com",
      projectId: "memes-world-6276b",
      storageBucket: "memes-world-6276b.appspot.com",
      messagingSenderId: "332915204004",
      appId: "1:332915204004:web:09074db940dfc1755ceb31",
      measurementId: "G-CWJX78W20M"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // â˜ï¸ Cloudinary config
    const cloudName = "dnwhmng9l";
    const uploadPreset = "unsigned_meme_upload";

    // UI elements
    const grid = document.getElementById("grid");
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");

    // ðŸ“Œ Upload to Cloudinary
    async function uploadToCloudinary(file) {
      const url = `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`;
      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", uploadPreset);

      const res = await fetch(url, { method: "POST", body: formData });
      const data = await res.json();
      return data.secure_url;
    }

    // ðŸ“Œ When user drops or picks a file
    async function handleFiles(files) {
      const file = files[0];
      if (!file) return;

      dropzone.textContent = "Uploading...";

      try {
        const imageUrl = await uploadToCloudinary(file);

        await db.collection("memes").add({
          url: imageUrl,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        dropzone.textContent = "Drop A Meme";
      } catch (err) {
        console.error(err);
        dropzone.textContent = "Upload Failed";
        setTimeout(() => dropzone.textContent = "Drop A Meme", 1500);
      }
    }

    // ðŸ“Œ Make grid
    function renderTiles(docs) {
      grid.innerHTML = "";
      docs.forEach(doc => {
        const url = doc.data().url;
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.innerHTML = `<img src="${url}" />`;
        grid.appendChild(tile);
      });

      // Fill empty spaces (18 tiles max)
      const remain = 18 - docs.length;
      for (let i = 0; i < remain; i++) {
        const tile = document.createElement("div");
        tile.className = "tile";
        grid.appendChild(tile);
      }
    }

    // ðŸ“Œ Get memes live
    db.collection("memes")
      .orderBy("createdAt", "desc")
      .limit(18)
      .onSnapshot(snap => {
        renderTiles(snap.docs);
      });

    // ðŸ“Œ Dropzone events
    dropzone.onclick = () => fileInput.click();
    fileInput.onchange = e => handleFiles(e.target.files);

    dropzone.ondragover = (e) => {
      e.preventDefault();
      dropzone.classList.add("dragover");
    };
    dropzone.ondragleave = () => dropzone.classList.remove("dragover");

    dropzone.ondrop = (e) => {
      e.preventDefault();
      dropzone.classList.remove("dragover");
      handleFiles(e.dataTransfer.files);
    };
  </script>
</body>
</html>
